<!DOCTYPE html>
<!--
    @author Bryan Haberberger
    https://github.com/thehabes
-->
<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <!-- <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
         integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
         crossorigin=""/> -->

        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css" integrity="sha512-07I2e+7D8p6he1SIM+1twR5TIrhUQn9+I6yjqD53JQjFiMf8EtC93ty0/5vJTZGF8aAocvHYNEDJajGdNx1IsQ==" crossorigin="">
        <link rel="stylesheet" href="./marker-clustering/MarkerCluster.Default.css" />
        <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
        <script src="./marker-clustering/leaflet.markercluster-src.js"></script>
        <script src="./app.js" type="module"></script>
        <link rel="stylesheet" href="./styling/inset.css" />
    </head>
    <body>
        <div class="row" id="kastorMap">
            <div class="col-12">
                <div class="slider-container is-hidden">
                    <div class="slider-controls">
                        <div id="instructionsContainer" class="">
                            <input id="instructions" type="button" class="button primary" value="how to use" onclick="openHowTo()" />
                        </div> 
                        <div class="inline year-dec" title="Move backward one year"> 
                            <span class="icon-fix">hack</span>
                            <img src="./images/map-icons/Fleur.de.lis.left.png" class="inline small-icon"/> 
                        </div> 
                        <h5 id="slider-value" class="inline">1829</h5> 
                        <div class="inline year-inc" title="Move forward one year">
                            <span class="icon-fix">hack</span>
                            <img src="./images/map-icons/Fleur.de.lis.right.png" class="inline small-icon"/> 
                        </div>
                        <div id="resetContainer" class="">
                            <input id="resetView" type="button" class="button primary" value="see all locations" />
                        </div>   
                    </div>
                    <div class="slide"> 
                        <h5 class="inline">1789</h5>
                        <input id="timeSlider" class="inline" type="range"  min="1789" max="1829" value="1829" step="1">
                        <h5 class="inline">1829</h5>
                    </div>
                </div>
                <div id="leafletInstanceContainer">
                    <div id="loadingMessage" style="text-align: center;">
                        Gathering Federal Employee Data...<br>
                    </div> 
                    <div id="kastorMapLegend" class="is-hidden">
                        <h5>Map Legend</h5>
                        <h7>Location Colors</h7>
                        <ul>
                            <li><span style="color:blue;">Location</span></li>
                            <li><span style="color:yellow;">Lighthouse</span></li>
                            <li><span style="color:lightgrey;">Building</span></li>
                            <li><span style="color:#008080;">Maritime Station</span></li>
                            <li><span style="color:pink;">State</span></li>
                            <li><span style="color:#7A55A6;">Non U.S. Location</span></li>
                            <!-- <li><span style="color:orange;">Overseas Location</span></li> -->
                        </ul>
                    </div>
                </div>
            </div>
            <div id="howToContainer" class="is-hidden">
                <div id="howTo" class="">
                    <input id="closeHowTo" class="button primary" value="close" onclick="closeHowTo(event)" />
                    <h2> Interface Help </h2>
                    <p>
                        This map visualizes the locations where federal employees did their work.  It is built on a series of layers, which you can choose by selecting <span class="layersIcon"></span>
                    </p>
                    <ul>
                        <li>
                            Clustered locations (clustered in groups at maximum distance, expandable spirals at mid-zoom, and dots at maximum zoom).
                        </li>
                        <li>
                            Individual locations (dots up to mid-zoom, and icons at maximum zoom).
                        </li>
                        <li>
                            Jurisdictional boundaries (federal judicial districts and judicial circuits and well as tax collection districts).
                        </li>
                        <li>
                            Counties (these operate as the basis for showing the location of postmasters, and counties are color weighted by the number of postmaster records for each county).
                        </li>
                        <li>
                            Various basemaps (both topographical maps of the natural landscape and detailed maps showing human-built features on the landscape).  Current global maps contain numerous features (states, highways, cities, etc.) that did not exist in the early American republic, but they are able to reach a closer level of magnification than topographical maps.
                        </li>
                    </ul>
                    
                    <p>
                        Map locations take two forms:
                    </p>
                    
                    <ul>
                        <li>
                            Most are specific locations, ranging from individual cities and towns to specific buildings, depending on the specificity of the original source data.
                        </li>
                        <li>
                            Some public officials were not located in an individual city or town, but rather were assigned to multiple locations or to an entire state.
                        </li>
                    </ul>
                    
                    <p> 
                        The map defaults to showing every location from 1789-1829, and you can always restore this default by selecting “SEE ALL LOCATIONS” to the right of the time slider.
                    </p>

                    <p> Location Icons </p>
                    <ul>
                        <li class="legendIcon"><span>Location</span>: <i class="u-icon"></i></li>
                        <li class="legendIcon"><span>Lighthouse</span>: <i class="l-icon"></i></li>
                        <li class="legendIcon"><span>Building</span>: <i class="b-icon"></i></li>
                        <li class="legendIcon"><span>Maritime Station</span>: <i class="m-icon"></i></li>
                        <li class="legendIcon"><span>State</span>: TODO</li>
                        <li class="legendIcon"><span>Native American Location</span>: TODO</li>
                        <!-- <li class="legendIcon"><span>Overseas Location</span>: <i class="o-icon"></i></li> -->
                    </ul>
                </div>
            </div>
        </div>
        <script>
            function closeHowTo(event){
                howToContainer.classList.add("is-hidden")
            }

            function openHowTo(event){
                howToContainer.classList.remove("is-hidden")
            }

            async function adjustNewberryData(){
    let countiesFeatureCollection = await fetch("./data/CountyBoundariesWithEmployeeCounts_new_adjusted.json").then(resp => resp.json()).catch(err => {return []})
    countiesFeatureCollection.features.forEach(county => {
        // if(county.properties.STATE_TERR === "Louisiana"){
        //     // Keep parishes, not counties.
        //     // We may need to consider extinct parishes of Orleans Territory as well.
        //     if(county.properties.CNTY_TYPE === "County"){
        //         county.properties.START_DATE_ORIG = county.properties.START_DATE
        //         county.properties.END_DATE_ORIG = county.properties.END_DATE
        //         county.properties.START_DATE = "1111-11-11"
        //         county.properties.END_DATE = "1111-11-11"
        //     }
        // }
        // else if(county.properties.STATE_TERR === "Orleans Territory"){
        //     // Keep parishes, not counties.
        //     // We may need to consider extinct parishes of Orleans Territory as well.
        //     if(county.properties.CNTY_TYPE === "County"){
        //         county.properties.START_DATE_ORIG = county.properties.START_DATE
        //         county.properties.END_DATE_ORIG = county.properties.END_DATE
        //         county.properties.START_DATE = "1111-11-11"
        //         county.properties.END_DATE = "1111-11-11"
        //     }
        // }
        // else if(county.properties.STATE_TERR === "South Carolina"){
        //     // Keep counties, not districts or parishes
        //     if(county.properties.CNTY_TYPE === "District" || county.properties.CNTY_TYPE === "Parish"){
        //         county.properties.START_DATE_ORIG = county.properties.START_DATE
        //         county.properties.END_DATE_ORIG = county.properties.END_DATE
        //         county.properties.START_DATE = "1111-11-11"
        //         county.properties.END_DATE = "1111-11-11"
        //     }
        // }

        if(county.properties.STATE_TERR === "South Carolina"){
            // Keep counties, not districts or parishes
            if(county.properties.CNTY_TYPE === "District"){
                county.properties.START_DATE = county.properties.START_DATE_ORIG
                county.properties.END_DATE = county.properties.END_DATE_ORIG
                delete county.properties.START_DATE_ORIG
                delete county.properties.END_DATE_ORIG
            }
        }
    })
    console.log(countiesFeatureCollection)
    return countiesFeatureCollection
}
        </script>
    </body>
</html>
